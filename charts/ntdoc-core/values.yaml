replicaCount: 2
# --- 自动扩缩容（按业务容器 CPU 利用率）---
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 8
  containerBased: true
  containerName: ntdoc-core     # 你的容器名是 {{ .Chart.Name }}，通常为 ntdoc-core
  targetCPUUtilizationPercentage: 80
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 0
      selectPolicy: Max
      policies:
        - type: Percent
          value: 100
          periodSeconds: 60
        - type: Pods
          value: 2
          periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300
      selectPolicy: Max
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
        - type: Pods
          value: 2
          periodSeconds: 60

image:
  repository: registry.digitalocean.com/ntdoc/ntdoc-core
  tag: "dev"   # CI/CD 用 --set image.tag 覆盖
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: regcred   # 先确保已创建

serviceAccount:
  create: true
  name: ""

containerPort: 8070

probes:
  enabled: true
  readinessPath: /actuator/health/readiness
  livenessPath:  /actuator/health/liveness
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 5
  livenessInitialDelaySeconds: 60
  livenessPeriodSeconds: 20
  readinessFailureThreshold: 6
  livenessFailureThreshold: 6
  startupProbe:
    enabled: true
    path: /actuator/health/liveness
    periodSeconds: 5
    failureThreshold: 30

service:
  type: ClusterIP
  port: 80
  targetPort: 8070

ingress:
  enabled: true
  className: "nginx"
  hosts:
    - host: api.ntdoc.site
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: ntdoc-core-tls
      hosts: [api.ntdoc.site]
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
topologySpread:
  enabled: true
  hostname:
    maxSkew: 1
    whenUnsatisfiable: ScheduleAnyway
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: "1"
    memory: 1Gi

# ✅ 非敏感配置（ConfigMap）
config:
  SPRING_PROFILES_ACTIVE: "dev"

# ✅ 敏感配置（Secret）
secrets:
  # Digital Ocean Spaces
  DO_SPACES_ACCESS_KEY: ""
  DO_SPACES_SECRET_KEY: ""
  # Keycloak
  KEYCLOAK_ADMIN_USERNAME: ""
  KEYCLOAK_ADMIN_PASSWORD: ""
  KEYCLOAK_CLIENT_SECRET: ""
  # Database
  SPRING_DATASOURCE_URL: ""
  SPRING_DATASOURCE_USERNAME: ""
  SPRING_DATASOURCE_PASSWORD: ""
